---
source: crates/php-parser/tests/integration.rs
assertion_line: 1774
expression: result.program
---
stmts:
  - kind:
      Declare:
        - - - strict_types
            - kind:
                Int: 1
              span:
                start: 27
                end: 28
        - ~
    span:
      start: 6
      end: 32
  - kind:
      Namespace:
        name:
          parts:
            - App
            - Http
            - Middleware
          kind: Qualified
          span:
            start: 42
            end: 61
        body: Simple
    span:
      start: 32
      end: 64
  - kind:
      Use:
        kind: Normal
        uses:
          - name:
              parts:
                - App
                - Auth
                - TokenValidator
              kind: Qualified
              span:
                start: 68
                end: 91
            alias: ~
            span:
              start: 68
              end: 91
    span:
      start: 64
      end: 93
  - kind:
      Use:
        kind: Normal
        uses:
          - name:
              parts:
                - App
                - Http
                - Request
              kind: Qualified
              span:
                start: 97
                end: 113
            alias: ~
            span:
              start: 97
              end: 113
    span:
      start: 93
      end: 115
  - kind:
      Use:
        kind: Normal
        uses:
          - name:
              parts:
                - App
                - Http
                - Response
              kind: Qualified
              span:
                start: 119
                end: 136
            alias: ~
            span:
              start: 119
              end: 136
    span:
      start: 115
      end: 139
  - kind:
      Interface:
        name: MiddlewareInterface
        extends: []
        members:
          - kind:
              Method:
                name: handle
                visibility: Public
                is_static: false
                is_abstract: false
                is_final: false
                by_ref: false
                params:
                  - name: request
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - Request
                          kind: Unqualified
                          span:
                            start: 198
                            end: 206
                      span:
                        start: 198
                        end: 206
                    default: ~
                    by_ref: false
                    variadic: false
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 198
                      end: 214
                  - name: next
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - callable
                          kind: Unqualified
                          span:
                            start: 216
                            end: 224
                      span:
                        start: 216
                        end: 224
                    default: ~
                    by_ref: false
                    variadic: false
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 216
                      end: 230
                return_type:
                  kind:
                    Named:
                      parts:
                        - Response
                      kind: Unqualified
                      span:
                        start: 233
                        end: 241
                  span:
                    start: 233
                    end: 241
                body: ~
                attributes: []
            span:
              start: 175
              end: 243
        attributes: []
    span:
      start: 139
      end: 244
  - kind:
      Class:
        name: AuthMiddleware
        modifiers:
          is_abstract: false
          is_final: false
          is_readonly: false
        extends: ~
        implements:
          - parts:
              - MiddlewareInterface
            kind: Unqualified
            span:
              start: 278
              end: 298
        members:
          - kind:
              Property:
                name: validator
                visibility: Private
                set_visibility: ~
                is_static: false
                is_readonly: true
                type_hint:
                  kind:
                    Named:
                      parts:
                        - TokenValidator
                      kind: Unqualified
                      span:
                        start: 321
                        end: 336
                  span:
                    start: 321
                    end: 336
                default: ~
                attributes: []
            span:
              start: 304
              end: 352
          - kind:
              Property:
                name: excludedPaths
                visibility: Private
                set_visibility: ~
                is_static: true
                is_readonly: false
                type_hint:
                  kind:
                    Named:
                      parts:
                        - array
                      kind: Unqualified
                      span:
                        start: 367
                        end: 372
                  span:
                    start: 367
                    end: 372
                default:
                  kind:
                    Array: []
                  span:
                    start: 390
                    end: 392
                attributes: []
            span:
              start: 352
              end: 399
          - kind:
              Method:
                name: __construct
                visibility: Public
                is_static: false
                is_abstract: false
                is_final: false
                by_ref: false
                params:
                  - name: validator
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - TokenValidator
                          kind: Unqualified
                          span:
                            start: 427
                            end: 442
                      span:
                        start: 427
                        end: 442
                    default: ~
                    by_ref: false
                    variadic: false
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 427
                      end: 452
                return_type: ~
                body:
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                PropertyAccess:
                                  object:
                                    kind:
                                      Variable: this
                                    span:
                                      start: 468
                                      end: 473
                                  property:
                                    kind:
                                      Identifier: validator
                                    span:
                                      start: 475
                                      end: 484
                              span:
                                start: 468
                                end: 484
                            op: Assign
                            value:
                              kind:
                                Variable: validator
                              span:
                                start: 487
                                end: 497
                        span:
                          start: 468
                          end: 497
                    span:
                      start: 468
                      end: 503
                attributes: []
            span:
              start: 399
              end: 510
          - kind:
              Method:
                name: handle
                visibility: Public
                is_static: false
                is_abstract: false
                is_final: false
                by_ref: false
                params:
                  - name: request
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - Request
                          kind: Unqualified
                          span:
                            start: 533
                            end: 541
                      span:
                        start: 533
                        end: 541
                    default: ~
                    by_ref: false
                    variadic: false
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 533
                      end: 549
                  - name: next
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - callable
                          kind: Unqualified
                          span:
                            start: 551
                            end: 559
                      span:
                        start: 551
                        end: 559
                    default: ~
                    by_ref: false
                    variadic: false
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 551
                      end: 565
                return_type:
                  kind:
                    Named:
                      parts:
                        - Response
                      kind: Unqualified
                      span:
                        start: 568
                        end: 581
                  span:
                    start: 568
                    end: 581
                body:
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                Variable: path
                              span:
                                start: 591
                                end: 596
                            op: Assign
                            value:
                              kind:
                                MethodCall:
                                  object:
                                    kind:
                                      Variable: request
                                    span:
                                      start: 599
                                      end: 607
                                  method:
                                    kind:
                                      Identifier: getPath
                                    span:
                                      start: 609
                                      end: 616
                                  args: []
                              span:
                                start: 599
                                end: 618
                        span:
                          start: 591
                          end: 618
                    span:
                      start: 591
                      end: 629
                  - kind:
                      Foreach:
                        expr:
                          kind:
                            StaticPropertyAccess:
                              class:
                                kind:
                                  Identifier: self
                                span:
                                  start: 638
                                  end: 642
                              member: excludedPaths
                          span:
                            start: 638
                            end: 658
                        key: ~
                        value:
                          kind:
                            Variable: excluded
                          span:
                            start: 662
                            end: 671
                        body:
                          kind:
                            Block:
                              - kind:
                                  If:
                                    condition:
                                      kind:
                                        Binary:
                                          left:
                                            kind:
                                              Variable: path
                                            span:
                                              start: 691
                                              end: 696
                                          op: Identical
                                          right:
                                            kind:
                                              Variable: excluded
                                            span:
                                              start: 701
                                              end: 710
                                      span:
                                        start: 691
                                        end: 710
                                    then_branch:
                                      kind:
                                        Block:
                                          - kind:
                                              Return:
                                                kind:
                                                  FunctionCall:
                                                    name:
                                                      kind:
                                                        Variable: next
                                                      span:
                                                        start: 737
                                                        end: 742
                                                    args:
                                                      - name: ~
                                                        value:
                                                          kind:
                                                            Variable: request
                                                          span:
                                                            start: 743
                                                            end: 751
                                                        unpack: false
                                                        span:
                                                          start: 743
                                                          end: 751
                                                span:
                                                  start: 737
                                                  end: 752
                                            span:
                                              start: 730
                                              end: 766
                                      span:
                                        start: 712
                                        end: 767
                                    elseif_branches: []
                                    else_branch: ~
                                span:
                                  start: 687
                                  end: 767
                          span:
                            start: 673
                            end: 777
                    span:
                      start: 629
                      end: 777
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                Variable: token
                              span:
                                start: 787
                                end: 793
                            op: Assign
                            value:
                              kind:
                                NullCoalesce:
                                  left:
                                    kind:
                                      MethodCall:
                                        object:
                                          kind:
                                            Variable: request
                                          span:
                                            start: 796
                                            end: 804
                                        method:
                                          kind:
                                            Identifier: getHeader
                                          span:
                                            start: 806
                                            end: 815
                                        args:
                                          - name: ~
                                            value:
                                              kind:
                                                String: Authorization
                                              span:
                                                start: 816
                                                end: 831
                                            unpack: false
                                            span:
                                              start: 816
                                              end: 831
                                    span:
                                      start: 796
                                      end: 833
                                  right:
                                    kind:
                                      String: ""
                                    span:
                                      start: 836
                                      end: 838
                              span:
                                start: 796
                                end: 838
                        span:
                          start: 787
                          end: 838
                    span:
                      start: 787
                      end: 848
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                Variable: token
                              span:
                                start: 848
                                end: 854
                            op: Assign
                            value:
                              kind:
                                FunctionCall:
                                  name:
                                    kind:
                                      Identifier: str_replace
                                    span:
                                      start: 857
                                      end: 868
                                  args:
                                    - name: ~
                                      value:
                                        kind:
                                          String: "Bearer "
                                        span:
                                          start: 869
                                          end: 878
                                      unpack: false
                                      span:
                                        start: 869
                                        end: 878
                                    - name: ~
                                      value:
                                        kind:
                                          String: ""
                                        span:
                                          start: 880
                                          end: 882
                                      unpack: false
                                      span:
                                        start: 880
                                        end: 882
                                    - name: ~
                                      value:
                                        kind:
                                          Variable: token
                                        span:
                                          start: 884
                                          end: 890
                                      unpack: false
                                      span:
                                        start: 884
                                        end: 890
                              span:
                                start: 857
                                end: 891
                        span:
                          start: 848
                          end: 891
                    span:
                      start: 848
                      end: 902
                  - kind:
                      If:
                        condition:
                          kind:
                            Empty:
                              kind:
                                Variable: token
                              span:
                                start: 912
                                end: 918
                          span:
                            start: 906
                            end: 919
                        then_branch:
                          kind:
                            Block:
                              - kind:
                                  Return:
                                    kind:
                                      New:
                                        class:
                                          kind:
                                            Identifier: Response
                                          span:
                                            start: 946
                                            end: 954
                                        args:
                                          - name: ~
                                            value:
                                              kind:
                                                Int: 401
                                              span:
                                                start: 955
                                                end: 958
                                            unpack: false
                                            span:
                                              start: 955
                                              end: 958
                                          - name: ~
                                            value:
                                              kind:
                                                Array:
                                                  - key:
                                                      kind:
                                                        String: error
                                                      span:
                                                        start: 961
                                                        end: 968
                                                    value:
                                                      kind:
                                                        String: Missing token
                                                      span:
                                                        start: 972
                                                        end: 987
                                                    unpack: false
                                                    span:
                                                      start: 961
                                                      end: 987
                                              span:
                                                start: 960
                                                end: 988
                                            unpack: false
                                            span:
                                              start: 960
                                              end: 988
                                    span:
                                      start: 942
                                      end: 989
                                span:
                                  start: 935
                                  end: 999
                          span:
                            start: 921
                            end: 1000
                        elseif_branches: []
                        else_branch: ~
                    span:
                      start: 902
                      end: 1000
                  - kind:
                      TryCatch:
                        body:
                          - kind:
                              Expression:
                                kind:
                                  Assign:
                                    target:
                                      kind:
                                        Variable: claims
                                      span:
                                        start: 1028
                                        end: 1035
                                    op: Assign
                                    value:
                                      kind:
                                        MethodCall:
                                          object:
                                            kind:
                                              PropertyAccess:
                                                object:
                                                  kind:
                                                    Variable: this
                                                  span:
                                                    start: 1038
                                                    end: 1043
                                                property:
                                                  kind:
                                                    Identifier: validator
                                                  span:
                                                    start: 1045
                                                    end: 1054
                                            span:
                                              start: 1038
                                              end: 1054
                                          method:
                                            kind:
                                              Identifier: validate
                                            span:
                                              start: 1056
                                              end: 1064
                                          args:
                                            - name: ~
                                              value:
                                                kind:
                                                  Variable: token
                                                span:
                                                  start: 1065
                                                  end: 1071
                                              unpack: false
                                              span:
                                                start: 1065
                                                end: 1071
                                      span:
                                        start: 1038
                                        end: 1072
                                span:
                                  start: 1028
                                  end: 1072
                            span:
                              start: 1028
                              end: 1086
                          - kind:
                              Expression:
                                kind:
                                  MethodCall:
                                    object:
                                      kind:
                                        Variable: request
                                      span:
                                        start: 1086
                                        end: 1094
                                    method:
                                      kind:
                                        Identifier: setAttribute
                                      span:
                                        start: 1096
                                        end: 1108
                                    args:
                                      - name: ~
                                        value:
                                          kind:
                                            String: user_id
                                          span:
                                            start: 1109
                                            end: 1118
                                        unpack: false
                                        span:
                                          start: 1109
                                          end: 1118
                                      - name: ~
                                        value:
                                          kind:
                                            Cast:
                                              - Int
                                              - kind:
                                                  ArrayAccess:
                                                    array:
                                                      kind:
                                                        Variable: claims
                                                      span:
                                                        start: 1125
                                                        end: 1132
                                                    index:
                                                      kind:
                                                        String: sub
                                                      span:
                                                        start: 1133
                                                        end: 1138
                                                span:
                                                  start: 1125
                                                  end: 1139
                                          span:
                                            start: 1120
                                            end: 1139
                                        unpack: false
                                        span:
                                          start: 1120
                                          end: 1139
                                span:
                                  start: 1086
                                  end: 1140
                            span:
                              start: 1086
                              end: 1154
                          - kind:
                              Expression:
                                kind:
                                  MethodCall:
                                    object:
                                      kind:
                                        Variable: request
                                      span:
                                        start: 1154
                                        end: 1162
                                    method:
                                      kind:
                                        Identifier: setAttribute
                                      span:
                                        start: 1164
                                        end: 1176
                                    args:
                                      - name: ~
                                        value:
                                          kind:
                                            String: roles
                                          span:
                                            start: 1177
                                            end: 1184
                                        unpack: false
                                        span:
                                          start: 1177
                                          end: 1184
                                      - name: ~
                                        value:
                                          kind:
                                            NullCoalesce:
                                              left:
                                                kind:
                                                  ArrayAccess:
                                                    array:
                                                      kind:
                                                        Variable: claims
                                                      span:
                                                        start: 1186
                                                        end: 1193
                                                    index:
                                                      kind:
                                                        String: roles
                                                      span:
                                                        start: 1194
                                                        end: 1201
                                                span:
                                                  start: 1186
                                                  end: 1203
                                              right:
                                                kind:
                                                  Array: []
                                                span:
                                                  start: 1206
                                                  end: 1208
                                          span:
                                            start: 1186
                                            end: 1208
                                        unpack: false
                                        span:
                                          start: 1186
                                          end: 1208
                                span:
                                  start: 1154
                                  end: 1209
                            span:
                              start: 1154
                              end: 1219
                        catches:
                          - types:
                              - parts:
                                  - InvalidArgumentException
                                kind: FullyQualified
                                span:
                                  start: 1228
                                  end: 1254
                            var: e
                            body:
                              - kind:
                                  Return:
                                    kind:
                                      New:
                                        class:
                                          kind:
                                            Identifier: Response
                                          span:
                                            start: 1283
                                            end: 1291
                                        args:
                                          - name: ~
                                            value:
                                              kind:
                                                Int: 401
                                              span:
                                                start: 1292
                                                end: 1295
                                            unpack: false
                                            span:
                                              start: 1292
                                              end: 1295
                                          - name: ~
                                            value:
                                              kind:
                                                Array:
                                                  - key:
                                                      kind:
                                                        String: error
                                                      span:
                                                        start: 1298
                                                        end: 1305
                                                    value:
                                                      kind:
                                                        MethodCall:
                                                          object:
                                                            kind:
                                                              Variable: e
                                                            span:
                                                              start: 1309
                                                              end: 1311
                                                          method:
                                                            kind:
                                                              Identifier: getMessage
                                                            span:
                                                              start: 1313
                                                              end: 1323
                                                          args: []
                                                      span:
                                                        start: 1309
                                                        end: 1325
                                                    unpack: false
                                                    span:
                                                      start: 1298
                                                      end: 1325
                                              span:
                                                start: 1297
                                                end: 1326
                                            unpack: false
                                            span:
                                              start: 1297
                                              end: 1326
                                    span:
                                      start: 1279
                                      end: 1327
                                span:
                                  start: 1272
                                  end: 1337
                            span:
                              start: 1227
                              end: 1339
                          - types:
                              - parts:
                                  - RuntimeException
                                kind: FullyQualified
                                span:
                                  start: 1346
                                  end: 1364
                              - parts:
                                  - LogicException
                                kind: FullyQualified
                                span:
                                  start: 1366
                                  end: 1382
                            var: e
                            body:
                              - kind:
                                  Expression:
                                    kind:
                                      ErrorSuppress:
                                        kind:
                                          FunctionCall:
                                            name:
                                              kind:
                                                Identifier: error_log
                                              span:
                                                start: 1401
                                                end: 1410
                                            args:
                                              - name: ~
                                                value:
                                                  kind:
                                                    Binary:
                                                      left:
                                                        kind:
                                                          String: "Auth error: "
                                                        span:
                                                          start: 1411
                                                          end: 1425
                                                      op: Concat
                                                      right:
                                                        kind:
                                                          MethodCall:
                                                            object:
                                                              kind:
                                                                Variable: e
                                                              span:
                                                                start: 1428
                                                                end: 1430
                                                            method:
                                                              kind:
                                                                Identifier: getMessage
                                                              span:
                                                                start: 1432
                                                                end: 1442
                                                            args: []
                                                        span:
                                                          start: 1428
                                                          end: 1444
                                                  span:
                                                    start: 1411
                                                    end: 1444
                                                unpack: false
                                                span:
                                                  start: 1411
                                                  end: 1444
                                        span:
                                          start: 1401
                                          end: 1445
                                    span:
                                      start: 1400
                                      end: 1445
                                span:
                                  start: 1400
                                  end: 1459
                              - kind:
                                  Return:
                                    kind:
                                      New:
                                        class:
                                          kind:
                                            Identifier: Response
                                          span:
                                            start: 1470
                                            end: 1478
                                        args:
                                          - name: ~
                                            value:
                                              kind:
                                                Int: 500
                                              span:
                                                start: 1479
                                                end: 1482
                                            unpack: false
                                            span:
                                              start: 1479
                                              end: 1482
                                          - name: ~
                                            value:
                                              kind:
                                                Array:
                                                  - key:
                                                      kind:
                                                        String: error
                                                      span:
                                                        start: 1485
                                                        end: 1492
                                                    value:
                                                      kind:
                                                        String: Internal error
                                                      span:
                                                        start: 1496
                                                        end: 1512
                                                    unpack: false
                                                    span:
                                                      start: 1485
                                                      end: 1512
                                              span:
                                                start: 1484
                                                end: 1513
                                            unpack: false
                                            span:
                                              start: 1484
                                              end: 1513
                                    span:
                                      start: 1466
                                      end: 1514
                                span:
                                  start: 1459
                                  end: 1524
                            span:
                              start: 1345
                              end: 1535
                        finally: ~
                    span:
                      start: 1010
                      end: 1535
                  - kind:
                      Return:
                        kind:
                          FunctionCall:
                            name:
                              kind:
                                Variable: next
                              span:
                                start: 1542
                                end: 1547
                            args:
                              - name: ~
                                value:
                                  kind:
                                    Variable: request
                                  span:
                                    start: 1548
                                    end: 1556
                                unpack: false
                                span:
                                  start: 1548
                                  end: 1556
                        span:
                          start: 1542
                          end: 1557
                    span:
                      start: 1535
                      end: 1563
                attributes: []
            span:
              start: 510
              end: 1570
          - kind:
              Method:
                name: exclude
                visibility: Public
                is_static: true
                is_abstract: false
                is_final: false
                by_ref: false
                params:
                  - name: paths
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - string
                          kind: Unqualified
                          span:
                            start: 1601
                            end: 1607
                      span:
                        start: 1601
                        end: 1607
                    default: ~
                    by_ref: false
                    variadic: true
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 1601
                      end: 1617
                return_type:
                  kind:
                    Named:
                      parts:
                        - void
                      kind: Unqualified
                      span:
                        start: 1620
                        end: 1624
                  span:
                    start: 1620
                    end: 1624
                body:
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                StaticPropertyAccess:
                                  class:
                                    kind:
                                      Identifier: self
                                    span:
                                      start: 1639
                                      end: 1643
                                  member: excludedPaths
                              span:
                                start: 1639
                                end: 1659
                            op: Assign
                            value:
                              kind:
                                Array:
                                  - key: ~
                                    value:
                                      kind:
                                        StaticPropertyAccess:
                                          class:
                                            kind:
                                              Identifier: self
                                            span:
                                              start: 1666
                                              end: 1670
                                          member: excludedPaths
                                      span:
                                        start: 1666
                                        end: 1686
                                    unpack: true
                                    span:
                                      start: 1663
                                      end: 1686
                                  - key: ~
                                    value:
                                      kind:
                                        Variable: paths
                                      span:
                                        start: 1691
                                        end: 1697
                                    unpack: true
                                    span:
                                      start: 1688
                                      end: 1697
                              span:
                                start: 1662
                                end: 1698
                        span:
                          start: 1639
                          end: 1698
                    span:
                      start: 1639
                      end: 1704
                attributes: []
            span:
              start: 1570
              end: 1706
        attributes: []
    span:
      start: 246
      end: 1707
  - kind:
      Class:
        name: RateLimitMiddleware
        modifiers:
          is_abstract: false
          is_final: false
          is_readonly: false
        extends: ~
        implements:
          - parts:
              - MiddlewareInterface
            kind: Unqualified
            span:
              start: 1746
              end: 1766
        members:
          - kind:
              ClassConst:
                name: MAX_REQUESTS
                visibility: Private
                value:
                  kind:
                    Int: 100
                  span:
                    start: 1801
                    end: 1804
                attributes: []
            span:
              start: 1772
              end: 1810
          - kind:
              ClassConst:
                name: WINDOW_SECONDS
                visibility: Private
                value:
                  kind:
                    Int: 60
                  span:
                    start: 1841
                    end: 1843
                attributes: []
            span:
              start: 1810
              end: 1850
          - kind:
              Method:
                name: handle
                visibility: Public
                is_static: false
                is_abstract: false
                is_final: false
                by_ref: false
                params:
                  - name: request
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - Request
                          kind: Unqualified
                          span:
                            start: 1873
                            end: 1881
                      span:
                        start: 1873
                        end: 1881
                    default: ~
                    by_ref: false
                    variadic: false
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 1873
                      end: 1889
                  - name: next
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - callable
                          kind: Unqualified
                          span:
                            start: 1891
                            end: 1899
                      span:
                        start: 1891
                        end: 1899
                    default: ~
                    by_ref: false
                    variadic: false
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 1891
                      end: 1905
                return_type:
                  kind:
                    Named:
                      parts:
                        - Response
                      kind: Unqualified
                      span:
                        start: 1908
                        end: 1921
                  span:
                    start: 1908
                    end: 1921
                body:
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                Variable: ip
                              span:
                                start: 1931
                                end: 1934
                            op: Assign
                            value:
                              kind:
                                MethodCall:
                                  object:
                                    kind:
                                      Variable: request
                                    span:
                                      start: 1937
                                      end: 1945
                                  method:
                                    kind:
                                      Identifier: getIp
                                    span:
                                      start: 1947
                                      end: 1952
                                  args: []
                              span:
                                start: 1937
                                end: 1954
                        span:
                          start: 1931
                          end: 1954
                    span:
                      start: 1931
                      end: 1964
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                Variable: key
                              span:
                                start: 1964
                                end: 1968
                            op: Assign
                            value:
                              kind:
                                Binary:
                                  left:
                                    kind:
                                      String: "rate:"
                                    span:
                                      start: 1971
                                      end: 1978
                                  op: Concat
                                  right:
                                    kind:
                                      Variable: ip
                                    span:
                                      start: 1981
                                      end: 1984
                              span:
                                start: 1971
                                end: 1984
                        span:
                          start: 1964
                          end: 1984
                    span:
                      start: 1964
                      end: 1994
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                Variable: count
                              span:
                                start: 1994
                                end: 2000
                            op: Assign
                            value:
                              kind:
                                MethodCall:
                                  object:
                                    kind:
                                      Variable: this
                                    span:
                                      start: 2003
                                      end: 2008
                                  method:
                                    kind:
                                      Identifier: getCount
                                    span:
                                      start: 2010
                                      end: 2018
                                  args:
                                    - name: ~
                                      value:
                                        kind:
                                          Variable: key
                                        span:
                                          start: 2019
                                          end: 2023
                                      unpack: false
                                      span:
                                        start: 2019
                                        end: 2023
                              span:
                                start: 2003
                                end: 2024
                        span:
                          start: 1994
                          end: 2024
                    span:
                      start: 1994
                      end: 2035
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                Variable: remaining
                              span:
                                start: 2035
                                end: 2045
                            op: Assign
                            value:
                              kind:
                                Binary:
                                  left:
                                    kind:
                                      ClassConstAccess:
                                        class:
                                          kind:
                                            Identifier: self
                                          span:
                                            start: 2048
                                            end: 2052
                                        member: MAX_REQUESTS
                                    span:
                                      start: 2048
                                      end: 2067
                                  op: Sub
                                  right:
                                    kind:
                                      Variable: count
                                    span:
                                      start: 2069
                                      end: 2075
                              span:
                                start: 2048
                                end: 2075
                        span:
                          start: 2035
                          end: 2075
                    span:
                      start: 2035
                      end: 2085
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                Variable: allowed
                              span:
                                start: 2085
                                end: 2093
                            op: Assign
                            value:
                              kind:
                                Binary:
                                  left:
                                    kind:
                                      Variable: remaining
                                    span:
                                      start: 2096
                                      end: 2106
                                  op: Greater
                                  right:
                                    kind:
                                      Int: 0
                                    span:
                                      start: 2109
                                      end: 2110
                              span:
                                start: 2096
                                end: 2110
                        span:
                          start: 2085
                          end: 2110
                    span:
                      start: 2085
                      end: 2121
                  - kind:
                      Return:
                        kind:
                          Match:
                            subject:
                              kind:
                                Bool: true
                              span:
                                start: 2135
                                end: 2139
                            arms:
                              - conditions:
                                  - kind:
                                      UnaryPrefix:
                                        op: BooleanNot
                                        operand:
                                          kind:
                                            Variable: allowed
                                          span:
                                            start: 2156
                                            end: 2164
                                    span:
                                      start: 2155
                                      end: 2164
                                body:
                                  kind:
                                    New:
                                      class:
                                        kind:
                                          Identifier: Response
                                        span:
                                          start: 2172
                                          end: 2180
                                      args:
                                        - name: ~
                                          value:
                                            kind:
                                              Int: 429
                                            span:
                                              start: 2181
                                              end: 2184
                                          unpack: false
                                          span:
                                            start: 2181
                                            end: 2184
                                        - name: ~
                                          value:
                                            kind:
                                              Array:
                                                - key:
                                                    kind:
                                                      String: error
                                                    span:
                                                      start: 2187
                                                      end: 2194
                                                  value:
                                                    kind:
                                                      String: Too many requests
                                                    span:
                                                      start: 2198
                                                      end: 2217
                                                  unpack: false
                                                  span:
                                                    start: 2187
                                                    end: 2217
                                            span:
                                              start: 2186
                                              end: 2218
                                          unpack: false
                                          span:
                                            start: 2186
                                            end: 2218
                                  span:
                                    start: 2168
                                    end: 2219
                                span:
                                  start: 2155
                                  end: 2219
                              - conditions: ~
                                body:
                                  kind:
                                    FunctionCall:
                                      name:
                                        kind:
                                          Variable: next
                                        span:
                                          start: 2244
                                          end: 2249
                                      args:
                                        - name: ~
                                          value:
                                            kind:
                                              Variable: request
                                            span:
                                              start: 2250
                                              end: 2258
                                          unpack: false
                                          span:
                                            start: 2250
                                            end: 2258
                                  span:
                                    start: 2244
                                    end: 2259
                                span:
                                  start: 2233
                                  end: 2259
                        span:
                          start: 2128
                          end: 2270
                    span:
                      start: 2121
                      end: 2276
                attributes: []
            span:
              start: 1850
              end: 2283
          - kind:
              Method:
                name: getCount
                visibility: Private
                is_static: false
                is_abstract: false
                is_final: false
                by_ref: false
                params:
                  - name: key
                    type_hint:
                      kind:
                        Named:
                          parts:
                            - string
                          kind: Unqualified
                          span:
                            start: 2309
                            end: 2315
                      span:
                        start: 2309
                        end: 2315
                    default: ~
                    by_ref: false
                    variadic: false
                    visibility: ~
                    set_visibility: ~
                    attributes: []
                    span:
                      start: 2309
                      end: 2320
                return_type:
                  kind:
                    Named:
                      parts:
                        - int
                      kind: Unqualified
                      span:
                        start: 2323
                        end: 2326
                  span:
                    start: 2323
                    end: 2326
                body:
                  - kind:
                      StaticVar:
                        - name: counts
                          default:
                            kind:
                              Array: []
                            span:
                              start: 2358
                              end: 2360
                          span:
                            start: 2348
                            end: 2360
                    span:
                      start: 2341
                      end: 2370
                  - kind:
                      Expression:
                        kind:
                          Assign:
                            target:
                              kind:
                                ArrayAccess:
                                  array:
                                    kind:
                                      Variable: counts
                                    span:
                                      start: 2370
                                      end: 2377
                                  index:
                                    kind:
                                      Variable: key
                                    span:
                                      start: 2378
                                      end: 2382
                              span:
                                start: 2370
                                end: 2384
                            op: Assign
                            value:
                              kind:
                                Ternary:
                                  condition:
                                    kind:
                                      Isset:
                                        - kind:
                                            ArrayAccess:
                                              array:
                                                kind:
                                                  Variable: counts
                                                span:
                                                  start: 2392
                                                  end: 2399
                                              index:
                                                kind:
                                                  Variable: key
                                                span:
                                                  start: 2400
                                                  end: 2404
                                          span:
                                            start: 2392
                                            end: 2405
                                    span:
                                      start: 2386
                                      end: 2406
                                  then_expr:
                                    kind:
                                      Binary:
                                        left:
                                          kind:
                                            ArrayAccess:
                                              array:
                                                kind:
                                                  Variable: counts
                                                span:
                                                  start: 2409
                                                  end: 2416
                                              index:
                                                kind:
                                                  Variable: key
                                                span:
                                                  start: 2417
                                                  end: 2421
                                          span:
                                            start: 2409
                                            end: 2423
                                        op: Add
                                        right:
                                          kind:
                                            Int: 1
                                          span:
                                            start: 2425
                                            end: 2426
                                    span:
                                      start: 2409
                                      end: 2426
                                  else_expr:
                                    kind:
                                      Int: 1
                                    span:
                                      start: 2429
                                      end: 2430
                              span:
                                start: 2386
                                end: 2430
                        span:
                          start: 2370
                          end: 2430
                    span:
                      start: 2370
                      end: 2440
                  - kind:
                      Return:
                        kind:
                          ArrayAccess:
                            array:
                              kind:
                                Variable: counts
                              span:
                                start: 2447
                                end: 2454
                            index:
                              kind:
                                Variable: key
                              span:
                                start: 2455
                                end: 2459
                        span:
                          start: 2447
                          end: 2460
                    span:
                      start: 2440
                      end: 2466
                attributes: []
            span:
              start: 2283
              end: 2468
        attributes: []
    span:
      start: 1709
      end: 2469
span:
  start: 0
  end: 2469
